---
layout: post
title: 博客搬家
slug: move_from_jianshu
date: 2022-01-15 12:00
status: publish
author: walker
categories: 
  - category
tags:
  - tag
---

## 原因

由于

1. 广告越来越多，为了显示广告，还把正文给藏了起来
2. 没有TOC
3. 会屏蔽文章
4. 导出机制不完善，文章越多越以后想导出越麻烦
5. 别的原因（比如self host)

等原因，我决定搬出简书，目前记录的笔记已达10万字，可见对简书也没啥别的意见，风传的对程序员不友好我也没太在意过，只是个写笔记的平台而已。

本来冲着TOC，是想选择掘金的，却发现掘金已经取消了批量导入的功能，一切的一切，都把我推向了独立博客，好歹至少没有各种限制。

这次仍然选择`githup pages`来做静态博客，好处不言而喻的，生成器本想继续用`hexo`，结果突然发现了一个叫`Maverick`的，它支持宽泛的md文件的路径和图片路径，并且支持本地图片和下载远程图片，这解决了`hexo`不支持本地图片的一个痛点，本来就是简单的需求，于是打算入坑这个并不热门的生成器：
1. 热度不高，开发者最近一次更新也至少6个月了
2. 只有两个官方主题，一个没有TOC，一个不怎么好看，还有一个第三方主题，仍然没有TOC，就是目前我用的这个

也就是说踩坑机率可能不低，也就是说，我因为`TOC`出坑，折腾了半天还是没有`TOC`...


## 迁移记录

1. Maverick会扫描指定目录下的所有`.md`文件，不论目录结构，我做了一个`posts`目录专门用来存放源文件
2. 打包下载简书的所有文章，google了一个导出所有md文件里图片并顺便把文件里的图片链接也改了的[方案](https://juejin.cn/post/6844904110244757511)
  * 我根据习惯的vscode笔记插件`dendron`的风格，做了一个统一的`assets`文件夹来保存图片，所以相应的markdown文件里引用图片也就用上了相对路径（原方案是仿照`typora`风格，每篇文章一个对应的assets文件夹）
3. 在读文件的位置顺便把`frontmatter`加上，我是把文件放到了四个物理文件夹里让它遍历（整理下载文档的时候手动分类了），主要是为了能自动生成每篇文章的`category`（根据文件夹名）
  * 什么是[frontmatter](https://github.com/AlanDecode/Maverick#file-arrangement-and-frontmatter)?
  * 最终的脚本发布在[这里](https://gist.github.com/walkerwzy/0c75e9b90b0b1806cf0e4aaeb845a17e)
4. 最终选择了[Prism](https://github.com/Reedo0910/Maverick-Theme-Prism)这个主题
5. 标准流程部署完`Github Pages`
6. 绑域名，雇用ssl，这些都能在控制面板完成（DNS做一个CNAME需要去域名后台那边设置）
7. 抄改了一个脚本，用来执行`Github Actions`，其实就是持续集成啦
  * 据说`xxxx.github.io`风格的repo名只能把网站发布在`main`分支上而不能是`gh_pages`上，因此，最终逻辑就是，代码往`source`分支提交，然后把生成的网站往`main`分支部署
  * [脚本地址]()

## 排坑记录

1. 简书下载下来的文本有时候有一些莫名其妙的不可打印字符，在build的时候Maverick这个工具都是直接报错处理，我不得不手动把这些字符找出来删除掉
2. 生成`frontmatter`时如果有格式错误的也会直接挂掉，同样需要你人工排查，再把文本改对
3. 以上都说明这个生成器的容错率是很低的，下面的不算坑，就是目前`Maverick`其实做得很单纯，就是生成器，而周边功能，比如生成博客模板，本地伺服/预览等功能都没有做，我考虑到各种编辑器都能设置代码片段，也没去干这个活了
4. 前面说了，主题太少，而且只有一个支持TOC的，很难看，我也没有去为选中的主题增加TOC了（要写CSS，响应式布局等），暂时目前这样吧