<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/e83a979bdfe76b3eb88998ea61cf43ad.json"
        }

    </script>
    
<title>walker's code blog</title>
<meta name="author" content="AlanDecode" />
<meta name="description" content="coder, reader" />
<meta property="og:title" content="walker's code blog" />
<meta property="og:description" content="coder, reader" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/page/7/" />
<meta property="og:image" content="walker's code blog" />
<meta name="twitter:title" content="walker's code blog" />
<meta name="twitter:description" content="coder, reader" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/android-chrome-512x512.png" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>    
    

<section id="prism__post-list" class="prism-section row">
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/iOS%E7%AD%BE%E5%90%8D%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" target="_self">iOS签名相关命令</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/iOS%E7%AD%BE%E5%90%8D%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" target="_self">
                <time class="text-uppercase">
                    October 09 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>用openssl查看CSR文件内容</p>
<pre><code>openssl asn1parse -i -in CertificateSigningRequest.certSigningRequest
</code></pre>
<p>查看下发的证书的内容:</p>
<pre><code>openssl x509 -inform der -in ios_development.cer -noout -text
</code></pre>
<p>可以使用如下命令查看一个mobileprovision：</p>
<pre><code>security cms -D -i embedded.mobileprovision
</code></pre>
<p>ipa文件是一个zip包，可以使用如下命令解压：</p>
<pre><code>/usr/bin/unzip -q xxx.ipa -d &lt;destination&gt;
</code></pre>
<p>用下面命令，列出系统中可用于签名的有效证书：</p>
<pre><code>/usr/bin/security find-identity -v -p codesigning
</code></pre>
<p>使用如下命令对xxx.app目录签名，codesign程序会自动将其中的文件都签名，（Frameworks不会自动签）：</p>
<pre><code>/user/bin/codesign -fs &quot;iPhone Developer: Your Cert Name (VDT388662Q)&quot; --no-strict Payload/xxx.app
</code></pre>
<p>最后用下面命令校验签名是否合法：</p>
<pre><code>/usr/bin/codesign -v xxx.app
</code></pre>
<p>使用zip命令重新打包成ipa包</p>
<pre><code>/usr/bin/zip -qry destination source
</code></pre>
<p><a href="%5Bhttps://zhuanlan.zhihu.com/p/53006952%5D(https://zhuanlan.zhihu.com/p/53006952)">来源</a></p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/iOS%E7%AD%BE%E5%90%8D%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E5%85%B3%E4%BA%8E%40synthesize/" target="_self">关于@synthesize</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E5%85%B3%E4%BA%8E%40synthesize/" target="_self">
                <time class="text-uppercase">
                    August 16 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>首先, <code>@synthesize myLocalVar = _myLocalVar;</code> 这句话是显式帮你省掉了一个 <code>getter</code> 方法和一个 <code>setter</code> 方法. 两个方法长什么样不赘述.</p><p>其次, 从某个版本的 Xcode 开始, 你连 <code>@synthesize</code> 这句话也不需要写了, 但是请注意, 这只是一个 IDE 的特性. 你不需要手动合成, 不代表 <code>@synthesize</code> 不作用了, 仅仅是让<strong>你</strong>能少写这一句话, 而 Xcode 帮你补全了.</p><p>再次, @synthesize 仅仅是一个 <a href="http://clang.llvm.org/docs/LanguageExtensions.html#objective-c-autosynthesis-of-properties">clang 的 Objective-C 语言扩展</a> (<code>autosynthesis of properties</code>), 然后<code>clang</code>恰好是 Xcode 的默认编译器. 也就是说, 如果你换成了 <code>gcc</code>, 那么这个特性也就不复存在了.</p><p>基于上述, 如果你使用了自己的文本编辑器, 然后用自己用 <code>clang</code> 从命令行编译, <code>@synthesize</code> 这一句话是需要自己写的.</p><p>最后, 有如下例外</p><ol>
<li>对于 <code>readwrite</code> 类型的属性, 你自行实现了 <code>getter</code> 和 <code>setter</code></li>
<li>对于 <code>readonly</code>  类型的属性, 你自行实现了 <code>getter</code>
 以上两种情况, 你一旦自行实现了对应的 <code>getter</code> 或 <code>setter</code>, 对于本文的<code>myLocalVar</code>例子, 你将发现 <code>_myLocalVar</code>没有了, 意味着你需要<code>@synthesize</code>一下.</li>
<li><code>dynamic</code>与<code>synthesize</code>是互斥的</li>
<li><code>@protocol</code>中声明的属性</li>
<li><code>category</code>中声明的属性</li>
<li>你覆盖(<code>overridden</code>)父类的属性时, 必须手动<code>synthesize</code>.</li>
</ol>
<p>参考资料:
1, <a href="https://stackoverflow.com/questions/19784454/when-should-i-use-synthesize-explicitly?answertab=votes">When should I use @synthesize explicitly?</a>
2, <a href="http://suree.org/2015/09/01/Dynamic-Synthesize/">@dynamic 与 @synthesize 关键词详解</a></p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E5%85%B3%E4%BA%8E%40synthesize/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E9%87%8D%E8%A3%85mac%E7%B3%BB%E7%BB%9F%E5%90%8Essh%E5%BC%82%E5%B8%B8/" target="_self">重装mac系统后ssh异常</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E9%87%8D%E8%A3%85mac%E7%B3%BB%E7%BB%9F%E5%90%8Essh%E5%BC%82%E5%B8%B8/" target="_self">
                <time class="text-uppercase">
                    August 03 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>表现在两个方面: <code>ssh 登录服务器</code>, 和<code>通过ssh 使用 git</code>, 报的错都是<code>Permissino denied (publickey)</code></p><h2>git异常的解决</h2>
<p>根据<a href="https://help.github.com/articles/error-permission-denied-publickey/">github文档</a>, 我可以解决第二个问题, 第一个问题(ssh login)解决后再来更新.</p><p>使用git出现问题, 并不局限于 github, 我连 gitlab 也是一样. 其实根据文档一项项检测,我在<code>ssh-add -l</code>这一句发现了问题, 虽然我生成了密钥, 但是它的输出显示我没有私钥, 照如下解决即可:</p><blockquote>
<p><strong>Tip</strong>: On most systems the default private keys (~/.ssh/id_rsa</p></blockquote>
<p>, ~/.ssh/id_dsa and ~/.ssh/identity) are <strong>automatically</strong> added to the SSH authentication agent. You shouldn't need to run <code>ssh-add path/to/key</code>
 unless you override the file name when you generate a key.</p><p>也就是说, 把你的id_rsa文件手动指定一下<code>ssh_add 文件路径</code>(不知道为什么会出这种鬼问题)</p><h2>SSH自动登录异常的解决</h2>
<p>这是补充的内容, 刚刚解决.</p><p>首先, 你登不上这是服务端的问题, 没有把你的公钥写到<code>~/.ssh/authorized_keys</code>里面去, 你想办法把它写进去(当你 <code>ssh</code> 不上去的时候, <code>scp</code>当然也不行)</p><p>写进去后, 仍然报错, 我们继续看日志:
<code>ssh root@mydomain.com -v</code> 或 <code>ssh root@mydomain.com -vvv</code> (更详细的日志)</p><p>通过看日志, 你可以一步步看到问题:</p>
<pre><code>...
debug2: service_accept: ssh-userauth
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug3: send packet: type 50
debug3: receive packet: type 51
debug1: Authentications that can continue: publickey
debug3: start over, passed a different list publickey
debug3: preferred publickey,keyboard-interactive,password
debug3: authmethod_lookup publickey
debug3: remaining preferred: keyboard-interactive,password
debug3: authmethod_is_enabled publickey
debug1: Next authentication method: publickey
debug1: Trying private key: .ssh/id_rsa
debug3: no such identity: .ssh/id_rsa: No such file or directory
debug2: we did not send a packet, disable method
debug1: No more authentication methods to try.
Permission denied (publickey).
</code></pre>
<p>注意截取的<strong>倒数第4行</strong>:
首先, 它昨天不是这么提示的, 它提示的是<code>.ssh/id_rsd</code>, 我到配置文件里把它改成了<code>rsa</code>, 因为我生成的是 <code>rsa</code></p><blockquote>
<p>配置文件的地址是: <code>/etc/ssh/ssh_config</code>, 改的节点名是<code>IdentityFile</code></p></blockquote>
<p>其次, 顺便看一下<code>RSAAuthentication</code> 和 <code>PubkeyAuthentication</code>这两项是不是 yes(如果是注释状态, 不要动, 默认是 yes)</p><p>这样, 服务端有你的公钥, 本地配置了 <code>IdentityFile</code> 路径, 就可以登录了, 但我一直没成功的原因在于, 我在原配置文件改的, 它是路径是<code>.ssh/id_rsa,.ssh/id_rsd</code>, 我单纯把 rsd 的去掉, 却没发现它的路径是错的, 直到看了日志提示这个文件不存在, 才想起把格式改对.</p><p>我碰到的情况不知道是不是个例, 比如同一个文件</p>
<pre><code>UserKnownHostsFile ~/.ssh/known_hosts,~/.ssh/known_hosts2
</code></pre>
<p>这一行, 路径格式却是正确的, 匪夷所思.</p><p>总之, 你碰到<code>Permission denied (public key)</code>这个问题, 就结合 git 和 server 这两情况, 看是没有 identity, 还是 id_rsa路径配错了. (前提是公钥必须已经写到服务器上去了)</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E9%87%8D%E8%A3%85mac%E7%B3%BB%E7%BB%9F%E5%90%8Essh%E5%BC%82%E5%B8%B8/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E5%A4%87%E4%BB%BDNginx%E8%AE%BE%E7%BD%AEphp%E7%9A%84%E6%96%B9%E6%B3%95/" target="_self">备份Nginx设置php的方法</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E5%A4%87%E4%BB%BDNginx%E8%AE%BE%E7%BD%AEphp%E7%9A%84%E6%96%B9%E6%B3%95/" target="_self">
                <time class="text-uppercase">
                    July 31 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>版本nginx/1.12.2</p>
<pre><code>  location ~ \.php$ {
    fastcgi_pass   unix:/run/php/php7.0-fpm.sock;
    fastcgi_param  SCRIPT_FILENAME $document_root/$fastcgi_script_name;
    include        fastcgi_params;
   }
</code></pre>
<p>我机器上的fastcgi_param值不对, 改成上图成功, 备份下</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E5%A4%87%E4%BB%BDNginx%E8%AE%BE%E7%BD%AEphp%E7%9A%84%E6%96%B9%E6%B3%95/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E8%AE%A9Objective-C%E4%B9%9F%E6%9C%89map%E5%8A%9F%E8%83%BD/" target="_self">让Objective-C也有map功能</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E8%AE%A9Objective-C%E4%B9%9F%E6%9C%89map%E5%8A%9F%E8%83%BD/" target="_self">
                <time class="text-uppercase">
                    July 30 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>map一个数组是大部分高级语言都有的, OC 没有, 有几个方案让它实现, 我优选出三个:</p><h2>原生实现</h2>
<p>其实就是<code>valueForKeyPath</code>的活用:</p><div class="highlight"><pre><span></span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">allEmployees</span><span class="w"> </span><span class="n">valueForKeyPath</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;[collect].{daysOff&lt;10}.name&quot;</span><span class="p">];</span><span class="w"></span>
<span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">albumCovers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">records</span><span class="w"> </span><span class="n">valueForKeyPath</span><span class="o">:</span><span class="s">@&quot;[collect].{artist like &#39;Bon Iver&#39;}.&lt;NSUnarchiveFromDataTransformerName&gt;.albumCoverImageData&quot;</span><span class="p">];</span><span class="w"></span>
</pre></div>
<h2>category</h2>
<p>这个大家肯定早想到过了, 你没有, 我给你扩展出来一个:</p><p>定义:</p><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="bp">NSArray</span> <span class="nl">(Map)</span><span class="w"></span>

<span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nf">mapObjectsUsingBlock:</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">id</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">idx</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span><span class="w"></span>

<span class="k">@end</span><span class="w"></span>

<span class="k">@implementation</span> <span class="bp">NSArray</span> <span class="nl">(Map)</span><span class="w"></span>

<span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nf">mapObjectsUsingBlock:</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">id</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">idx</span><span class="p">))</span><span class="nv">block</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">NSMutableArray</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSMutableArray</span><span class="w"> </span><span class="n">arrayWithCapacity</span><span class="o">:</span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">count</span><span class="p">]];</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">enumerateObjectsUsingBlock</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="kt">BOOL</span><span class="w"> </span><span class="o">*</span><span class="n">stop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">result</span><span class="w"> </span><span class="n">addObject</span><span class="o">:</span><span class="n">block</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="p">)];</span><span class="w"></span>
<span class="w">    </span><span class="p">}];</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="n">o</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">@end</span><span class="w"></span>
</pre></div>
<p>使用:</p><div class="highlight"><pre><span></span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">people</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="l">@[</span><span class="w"></span>
<span class="w">                     </span><span class="l">@{</span><span class="w"> </span><span class="s">@&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Boston&quot;</span><span class="w"> </span><span class="l">}</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="l">@{</span><span class="w"> </span><span class="s">@&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Rob&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Cambridge&quot;</span><span class="w"> </span><span class="l">}</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="l">@{</span><span class="w"> </span><span class="s">@&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Robert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Somerville&quot;</span><span class="w"> </span><span class="l">}</span><span class="w"></span>
<span class="w">                  </span><span class="l">]</span><span class="p">;</span><span class="w"></span>
<span class="c1">// per the original question</span>
<span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">people</span><span class="w"> </span><span class="n">mapObjectsUsingBlock</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span><span class="p">[</span><span class="s">@&quot;name&quot;</span><span class="p">];</span><span class="w"></span>
<span class="p">}];</span><span class="w"></span>
<span class="c1">// (Bob, Rob, Robert)</span>

<span class="c1">// you can do just about anything in a block</span>
<span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">fancyNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">people</span><span class="w"> </span><span class="n">mapObjectsUsingBlock</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="bp">NSString</span><span class="w"> </span><span class="n">stringWithFormat</span><span class="o">:</span><span class="s">@&quot;%@ of %@&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">[</span><span class="s">@&quot;name&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">obj</span><span class="p">[</span><span class="s">@&quot;city&quot;</span><span class="p">]];</span><span class="w"></span>
<span class="p">}];</span><span class="w"></span>
<span class="c1">// (Bob of Boston, Rob of Cambridge, Robert of Somerville)</span>
</pre></div>
<h2>三方库</h2>
<p>是的, 一般简单功能能自己实现就自己实现, xcode 项目还是不能像 <code>nodejs</code>项目一样, 哪怕有的包里也只有一句话, 我也要从用第三方的...ddddd</p><p>js 的世界里, <code>underscore</code>用来处理数组可算神器, 自然, 我也挑中了同样名字的 OC 库: <a href="http://underscorem.org/">Underscore</a></p><div class="highlight"><pre><span></span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">tweets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Underscore</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Let&#39;s make sure that we only operate on NSDictionaries, you never</span>
<span class="w">    </span><span class="c1">// know with these APIs ;-)</span>
<span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Underscore</span><span class="p">.</span><span class="n">isDictionary</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Remove all tweets that are in English</span>
<span class="w">    </span><span class="p">.</span><span class="n">reject</span><span class="p">(</span><span class="o">^</span><span class="kt">BOOL</span><span class="w"> </span><span class="p">(</span><span class="bp">NSDictionary</span><span class="w"> </span><span class="o">*</span><span class="n">tweet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">tweet</span><span class="p">[</span><span class="s">@&quot;iso_language_code&quot;</span><span class="p">]</span><span class="w"> </span><span class="n">isEqualToString</span><span class="o">:</span><span class="s">@&quot;en&quot;</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Create a simple string representation for every tweet</span>
<span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">^</span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="bp">NSDictionary</span><span class="w"> </span><span class="o">*</span><span class="n">tweet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tweet</span><span class="p">[</span><span class="s">@&quot;from_user_name&quot;</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tweet</span><span class="p">[</span><span class="s">@&quot;text&quot;</span><span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="bp">NSString</span><span class="w"> </span><span class="n">stringWithFormat</span><span class="o">:</span><span class="s">@&quot;%@: %@&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">;</span><span class="w"></span>
</pre></div>
<blockquote>
<p>当然, 所有方案来源于<a href="http://stackoverflow.com/questions/6127638/nsarray-equivalent-of-map">StackOverflow</a> 上的答案, 一些其它方案, 其它库(如<a href="http://cocoadocs.org/docsets/BlocksKit/2.2.3/Categories/NSArray+BlocksKit.html#//api/name/bk_map:">BlocksKit</a>), 都可以试试, 也挺简洁的</p></blockquote>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E8%AE%A9Objective-C%E4%B9%9F%E6%9C%89map%E5%8A%9F%E8%83%BD/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E8%AE%A9%E4%BD%A0fork%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%8E%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5/" target="_self">让你fork下来的项目与源项目保持同步</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E8%AE%A9%E4%BD%A0fork%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%8E%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5/" target="_self">
                <time class="text-uppercase">
                    March 23 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>原文<a href="https://2buntu.com/articles/1459/keeping-your-forked-repo-synced-with-the-upstream-source/">在此</a>, 建议阅读, 我把关键步骤抽出来了, 方便概览</p><p>(也就是add remote upstream, fetch upstream, rebase, 再push)</p><p>Step 1: Forking a repo</p>
<pre><code>git clone https://github.com/nitin-test/blog-example-fork.git
git remote add upstream https://github.com/nitstorm/blog-example.git
git remote
git remote show origin
git remote show upstream
</code></pre>
<p>Step 2: Making changes and submitting Pull Requests</p>
<pre><code>git checkout -b word-addition
git commit -am &quot;Adds the word memory&quot;
git push origin word-addition
# 网页端发起merge到master
</code></pre>
<p>Step 3: Keeping the forked repo synced with the main repo</p>
<pre><code># 确保你是在master分支
git checkout master
git fetch upstream
git rebase upstream/master
git push origin master
</code></pre>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E8%AE%A9%E4%BD%A0fork%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%8E%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/Windows%E4%B8%8B%E7%94%A8AHK%E6%9D%A5%E6%98%A0%E5%B0%84Mac%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" target="_self">Windows下用AHK来映射Mac常用快捷键</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/Windows%E4%B8%8B%E7%94%A8AHK%E6%9D%A5%E6%98%A0%E5%B0%84Mac%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" target="_self">
                <time class="text-uppercase">
                    March 17 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>最近用Windows做了一段主力机, 别的问题倒没啥, Windows下有啥干不了的呢, 哪怕鼠标滚轮方向相反, 大量快捷键不同等问题都能在非常短的适应后就不会对自己造成什么困找, 问题是我还得在Windows和Mac环境切来切去, 这样频繁地按错快捷键再纠正也挺烦人的, 决定一劳永逸地解决这个问题, 经过反复搜索和比较, 还是一个以前用Windows的时候就一直敬而远之的软件成了我的首选:AutoHotKey(AHK).</p><p>以前不想用它就是因为要写脚本, 没有大量的需求的情况下我并不想去通读一遍那并不算短的文档, 这次不同了, 需要定制一堆快捷键, 感觉这个付出是值得的, 一番文档和实验之后, 初步得到如下脚本:
(特别惊喜的是, 之前要改变鼠标滚轮的方向要改注册表, 这样你每次换了个usb口插鼠标还得再改一次, 而在ahk下都是一句话的事...是不是有点佩服这个才百来k的软件了?)</p><div class="highlight"><pre><span></span><span class="p">;</span><span class="o">----------</span><span class="n">Application</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="n">hyper</span><span class="w"></span>
<span class="o">^</span><span class="err">`</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="err">#</span><span class="mi">4</span><span class="w"></span>

<span class="p">;</span><span class="o">----------</span><span class="n">Mac</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="n">Remap</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="n">nature</span><span class="w"> </span><span class="n">scroll</span><span class="w"></span>
<span class="p">;</span><span class="n">WheelUp</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="p">{</span><span class="n">WheelDown</span><span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="n">WheelDown</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="p">{</span><span class="n">WheelUp</span><span class="p">}</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="n">cmd</span><span class="o">+</span><span class="n">c</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="w"></span>
<span class="cp">#c::send ^c</span>
<span class="cp">#v::send ^v</span>
<span class="cp">#x::send ^x</span>
<span class="p">;</span><span class="w"> </span><span class="n">用win</span><span class="o">+</span><span class="n">shift</span><span class="o">+</span><span class="n">x来替换原来的win</span><span class="o">+</span><span class="n">x</span><span class="w"></span>
<span class="cp">#+x::send #x</span>

<span class="p">;</span><span class="w"> </span><span class="n">clipboard</span><span class="w"> </span><span class="n">history</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">用win</span><span class="o">+</span><span class="n">shift</span><span class="o">+</span><span class="n">v来替换原来的win</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="n">剪贴板历史记录</span><span class="p">)</span><span class="w"></span>
<span class="cp">#+v::send #v</span>

<span class="p">;</span><span class="w"> </span><span class="n">save</span><span class="w"></span>
<span class="cp">#s::send ^s</span>

<span class="p">;</span><span class="w"> </span><span class="n">undo</span><span class="p">,</span><span class="w"> </span><span class="n">redo</span><span class="w"></span>
<span class="cp">#z::send ^z</span>
<span class="cp">#+z::send ^+z</span>

<span class="p">;</span><span class="w"> </span><span class="n">selection</span><span class="w"></span>
<span class="cp">#+Left::send +{Home}</span>
<span class="cp">#+Right::send +{End}</span>
<span class="cp">#+Up::send +{Up}</span>
<span class="cp">#+Down::send +{Down}</span>

<span class="p">;</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">alt</span><span class="o">+</span><span class="n">Arrow</span><span class="w"></span>
<span class="o">!</span><span class="n">Left</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="o">^</span><span class="p">{</span><span class="n">Left</span><span class="p">}</span><span class="w"></span>
<span class="o">!</span><span class="n">Right</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="o">^</span><span class="p">{</span><span class="n">Right</span><span class="p">}</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="n">win</span><span class="o">+</span><span class="n">tab</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">alt</span><span class="o">+</span><span class="n">tab</span><span class="w"></span>
<span class="n">releaseAltKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">GetKeyState</span><span class="p">(</span><span class="s">&quot;LWin&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">sleep</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="w">    </span><span class="n">releaseAltKey</span><span class="p">()</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="n">send</span><span class="w"> </span><span class="p">{</span><span class="n">alt</span><span class="w"> </span><span class="n">up</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#Tab::</span>
<span class="n">send</span><span class="w"> </span><span class="p">{</span><span class="n">alt</span><span class="w"> </span><span class="n">down</span><span class="p">}{</span><span class="n">Tab</span><span class="p">}</span><span class="w"></span>
<span class="n">releaseAltKey</span><span class="p">()</span><span class="w"></span>
<span class="k">return</span><span class="w"></span>

<span class="o">!</span><span class="n">Tab</span><span class="o">::</span><span class="n">send</span><span class="w"> </span><span class="err">#</span><span class="p">{</span><span class="n">Tab</span><span class="p">}</span><span class="w"></span>

<span class="p">;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="n">ctrl</span><span class="o">+</span><span class="n">w</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">cmd</span><span class="o">+</span><span class="n">w</span><span class="w"></span>
<span class="cp">#w::send ^{w}</span>
<span class="p">;</span><span class="w"> </span><span class="n">用win</span><span class="o">+</span><span class="n">shift</span><span class="o">+</span><span class="n">w替换win</span><span class="o">+</span><span class="n">w</span><span class="w"></span>
<span class="cp">#+w::send #{w}</span>

<span class="p">;</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">tab</span><span class="w"></span>
<span class="cp">#t::send ^t</span>
<span class="cp">#+t::send ^+t</span>

<span class="p">;</span><span class="w"> </span><span class="n">search</span><span class="w"></span>
<span class="cp">#f::send ^f</span>

<span class="p">;</span><span class="w"> </span><span class="n">cmd</span><span class="o">+</span><span class="n">a</span><span class="w"></span>
<span class="cp">#a::send ^a</span>

<span class="p">;</span><span class="w"> </span><span class="n">cmd</span><span class="o">+</span><span class="n">n</span><span class="w"></span>
<span class="cp">#n::send ^n</span>
</pre></div>
<p>我这里不是教程, 就不解释每一行的原理了, 就我个人而言最最最常用的复制粘贴切换程序等等都映射了, 唯一不完美的地方就在于把热键对换我没研究透(比如ctrl+x 和 win+x对换), 有三处热键对换, 但只有一处成功(alt+tab 和 win+tab互换), 其它两处只能把其中一个热键换成别的, 而不能互相替换, 在官方论坛发贴目前还没人答复我.</p><p>多说一句, 最前面的<code>Application</code>部分我贴代码的时候没删, 也是为了介绍一种打开程序的快捷方法的思路, 一般人会用脚本检测程序是否打开, 比如<code>邮件</code>应用, 如果打开, 则将窗口激活, 如果没有, 则打开程序, 如果当然已是激活状态, 则把它最小化. 而我发现如果一个程序在底部状态栏里的话, 用win+数字键激活它也可以达到上述三个目的, 比如我的<code>hyper</code>应用排在第四个, 那么我只要反复按<code>win+4</code>就能在上述三种状态间切换, 比写代码完成检测, 打开, 激活, 最小化等要来得简单的多.</p><p>期间还有一个收获, mac下多桌面的切换非常简单, ctrl+左右方向键即可, 或者用四根手势轻扫触摸板, 而windows下则点taskview图标, 或者用win+tab激活, 然后再用鼠标选择(总的来说是 Win + Ctrl + D / F4 / ← / → 这些组合), 怎样都没有mac的方案来得优雅(就像mac下没有一个窗口管理程序有windows自带的优雅一样^_^), 发现有人写了一个脚本检测鼠标位置, 如果到了最右侧或最左侧, 就直接把下一个桌面拉出来, 原本没打算分享只是自己用用, 因此出处没保存, 抱歉, 不过类似的脚本网上很多, 还有很多很精细的, 这一个已经算很简单粗暴了, 可以抱着学习的目的了解下, 毕竟这个脚本是以毫秒级别在时刻监视鼠标位置, 这是没必要的性能消耗吧:</p><div class="highlight"><pre><span></span><span class="p">;</span><span class="o">----------------</span><span class="n">屏幕热区</span><span class="w"></span>
<span class="p">;</span><span class="n">这个是设置鼠标坐标的相对位置</span><span class="err">，</span><span class="n">本例是相对雨整个桌面</span><span class="w"></span>
<span class="n">CoordMode</span><span class="p">,</span><span class="w"> </span><span class="n">Mouse</span><span class="w"> </span><span class="p">,</span><span class="n">Screen</span><span class="w"></span>

<span class="cp">#Persistent</span>
<span class="p">;</span><span class="n">这个设置了获取鼠标信息的频率</span><span class="err">，</span><span class="n">数值越小边缘热区越灵敏</span><span class="w"></span>
<span class="n">SetTimer</span><span class="p">,</span><span class="w"> </span><span class="n">WatchCursor</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="w"></span>
<span class="k">return</span><span class="w"></span>

<span class="nl">WatchCursor</span><span class="p">:</span><span class="w"></span>
<span class="n">GetKeyState</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">LButton</span><span class="w"> </span>
<span class="n">MouseGetPos</span><span class="p">,</span><span class="w"> </span><span class="n">xpos</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="w"> </span>
<span class="p">;</span><span class="n">若要重设边缘热区的范围请</span><span class="err">，</span><span class="n">把下一行的</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">号去掉</span><span class="err">，</span><span class="n">就会在鼠标位置显示鼠标的坐标</span><span class="err">，</span><span class="n">根据坐标修改以下数值</span><span class="w"></span>
<span class="p">;</span><span class="n">ToolTip</span><span class="p">,</span><span class="n">x</span><span class="o">:%</span><span class="n">xpos</span><span class="o">%</span><span class="w"> </span><span class="n">y</span><span class="o">:%</span><span class="n">ypos</span><span class="o">%</span><span class="w"> </span><span class="n">state</span><span class="o">:%</span><span class="n">state</span><span class="o">%</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;U&quot;</span><span class="w"> </span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="p">;</span><span class="n">y方向的范围</span><span class="w"></span>
<span class="w">    </span><span class="nf">if</span><span class="p">(</span><span class="n">ypos</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">ypos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="p">;</span><span class="n">x方向的范围</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">xpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2879</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="n">sleep</span><span class="w"> </span><span class="mi">650</span><span class="w"></span>
<span class="w">            </span><span class="n">Send</span><span class="w"> </span><span class="o">^</span><span class="err">#</span><span class="p">{</span><span class="n">Right</span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">MouseMove</span><span class="p">,</span><span class="w"> </span><span class="mi">2870</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">xpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="n">sleep</span><span class="w"> </span><span class="mi">650</span><span class="w"></span>
<span class="w">            </span><span class="n">Send</span><span class="w"> </span><span class="o">^</span><span class="err">#</span><span class="p">{</span><span class="n">Left</span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">MouseMove</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">;</span><span class="n">显示所有虚拟桌面的热区</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">xpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">ypos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">Send</span><span class="w"> </span><span class="err">#</span><span class="p">{</span><span class="n">Tab</span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">MouseMove</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">return</span><span class="w"></span>
</pre></div>
<p>注释很明确了, 自己读, 鼠标检测的热区是代码写死的, 解除显示鼠标位置的注释, 然后你把代码改成适合你的屏幕分辨率的数值即可</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/Windows%E4%B8%8B%E7%94%A8AHK%E6%9D%A5%E6%98%A0%E5%B0%84Mac%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E5%BC%80%E5%8F%91apple-pay%E7%A2%B0%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" target="_self">开发apple-pay碰到的问题总结</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E5%BC%80%E5%8F%91apple-pay%E7%A2%B0%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" target="_self">
                <time class="text-uppercase">
                    March 04 2019
                </time>
            </a>
        </div>
        <div class="prism-content"><p>本来想简单总结一下Apple Pay 开发过程中的几个问题, 结果被<a href="http://www.lilongcnc.cc/2016/02/28/9-applepay%E6%94%AF%E4%BB%98%E7%95%8C%E9%9D%A2%E8%B0%83%E7%94%A8%E5%92%8C%E8%8E%B7%E5%8F%96payment%E5%8F%82%E6%95%B0%E9%93%B6%E8%81%94%E6%89%A3%E6%AC%BE%E6%B5%81%E7%A8%8B/">这篇文章</a>全碰上了, 干脆全文转载, 作者对相关资源整理得比较详细, 比较有参考价值, 建议阅读, 我做个概述.</p><p>总的来说, 我们做过 APNs 推送的话, 申请 商户ID 并关联到 apple id, 申请证书, 生成provisioning profile等步骤都差不多</p><p>然后我真机调试有两个地方没通过, 下文也总结了, 我拎出来单独说一下:</p><p>1, Payment request is invalid: check your entitlements. Connection to remote alert view service failed</p><blockquote>
<p>原因:</p></blockquote>
<p>粗心, 把merchant id写错了.
之所以要把粗心的事也列出来, 是因为, 我出问题是粗心, 但是因为集成苹果支付的过程中, 是需要在配置界面的<code>Capabilities</code>里面用下拉列表选择一个<code>merchant id</code>, 以及代码里还要写一次的, 如果你有多个<code>merchant id</code>, 或者开发过程中切换过, 下拉列表值和代码里手写的值要记得同步, 没有同步, 一样会得上上面的错误</p><p>2, 进不到didAuthorizePayment方法.</p><blockquote>
<p>原因:</p></blockquote>
<p><code>payrequest.merchantCapabilities = PKMerchantCapability3DS|PKMerchantCapabilityEMV</code>. 
看到了吧, 后面的 EMV 是必须要加的
大部分碰到同样问题的同学估计都是看 WWDC 的视频, 里面的小哥说3DS 是必须的, 显然在咱们大天朝, EMV 也是必须的.</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E5%BC%80%E5%8F%91apple-pay%E7%A2%B0%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/" target="_self">百度地图坐标转换</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/" target="_self">
                <time class="text-uppercase">
                    December 28 2018
                </time>
            </a>
        </div>
        <div class="prism-content"><p>首先, 我们了解一下为什么要坐标转换</p><blockquote>
<p>国际经纬度坐标标准为WGS-84,国内必须至少使用国测局制定的GCJ-02,对地理位置进行首次加密。百度坐标在此基础上，进行了BD-09二次加密措施,更加保护了个人隐私。百度对外接口的坐标系并不是GPS采集的真实经纬度，需要通过坐标转换接口进行转换。</p></blockquote>
<p>其次, 我们在网上搜到有通过
<code>http://api.map.baidu.com/ag/coord/convert?from=[0/2]&amp;to=4&amp;x=纬度&amp;y=经度</code>
这种URL来进行转换的, 其中<code>0</code>代表<code>WGS-84</code>即标准GPS设备返回的坐标, <code>2</code>代表国测局的标准, 显然<code>4</code>就是百度地图认的坐标了. 但我遍搜网络, 这个接口是没有文档的(但是确实可用). 因为会碰到跨域的问题(<code>CORS</code>), 所以就用了jQuery中script标签跨域的方式来执行, 结果这个脚本也被百度”回收”了, 当然, 网上还是有痕迹的, 我把它保存了一下, 见此<a href="https://gist.github.com/walkerwzy/718052e1c99e26ab3668">gist</a>. 
我没在这上面花太多时间, 并没有测它支不支持批量转换(看网友写了一个transMore, 是必须批量送入, 但底层还是一次次分别请求, 不合我意).</p><p>而事实上, 百度已经提供了文档化的<a href="http://lbsyun.baidu.com/index.php?title=webapi/guide/changeposition">坐标转换接口</a>, 并且原生就支持批量请求. 显然, 我们应该用文档化的方法, 只是这种用法需要申请成为一个开发者, 添加一个应用. 这不是小事么, 于是我小包装了一下, 见此<a href="https://gist.github.com/walkerwzy/e21cc369d21bd2301932">gist</a>.</p><p>仅仅有一点小要求, 就是传入的坐标, 键名分别是<code>lon</code>(经度)和<code>lat</code>和(纬度), 并且可以传入一个(传入一个, 返回也是一个), 或者一组</p><p>转换一个坐标:</p>
<pre><code>BMap.Convertor.translate({lon:lon, lat:lat}, 1, 5, bdkey, function (point, status, message) {
    if(status) return show(message || &quot;转换坐标出错:&quot;+status, true);
    var curmarker = new BMap.Marker(point);
    baidumap.addOverlay(curmarker);
});
</code></pre>
<p>一组坐标:</p>
<pre><code>BMap.Convertor.translate([{lon:lon, lat:lat},...], 1, 5, bdkey, function (points, status, message) {
    if(status) return show(message || &quot;转换坐标出错:&quot;+status, true);
    // 遍历points
});
</code></pre>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%A9%E7%94%A8Privoxy%2CShadowsocks%2CKcptun%E5%81%9Ahttp%E4%BB%A3%E7%90%86%E6%8E%92%E5%9D%91%E8%AE%B0%E5%BD%95/" target="_self">树莓派利用Privoxy,Shadowsocks,Kcptun做http代理排坑记录</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%A9%E7%94%A8Privoxy%2CShadowsocks%2CKcptun%E5%81%9Ahttp%E4%BB%A3%E7%90%86%E6%8E%92%E5%9D%91%E8%AE%B0%E5%BD%95/" target="_self">
                <time class="text-uppercase">
                    November 12 2018
                </time>
            </a>
        </div>
        <div class="prism-content"><p>我用树莓派做<code>翻墙网关</code>, <code>透明网关</code>, 通通绕到坑里出不来了, 方案很多, 思路是树莓派翻, 智能dns, 智能国内外分流, 外加让树莓派成为局域网的<code>网关</code>以便让局域网用户<code>无感翻墙</code>.<br />
黑科技没玩转, 于是我整理思绪, 做一个最简单的局域网http代理服务器吧. 任何网络设备/应用都能找到设http代理的地方, 这样最后只要让树莓派能应用<code>gfwlist</code>的规则.</p><p>我们来看一下最终的拓扑:
<figure  style="flex: 65.81740976645435" ><img width="1240" height="942" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/82dd9437cc67d2b686f739ff2c5cf8a1.png" alt=""/></figure></p><p>几点说明:</p><ol>
<li>如果只是Shadowsocks翻墙, 那么这一步做完就收工了. 最简步骤</li>
<li>如果需要转成http代理, 你就再多包一层代理工具, <code>Prixovy</code>, <code>Polipo</code>等, 用关键词搜, 比, 自己定. <code>Polipo</code>配置要简单很多</li>
<li>对, 不考虑做成网关就是这么简单, 但是我还想用<code>kcptun</code>给提提速, 所以多插一脚</li>
<li>不需要更多了, 再多就又有新坑了.</li>
</ol>
<p>开始排坑</p><h1>shadowsocks-libev</h1>
<p>我使用的是一键安装脚本, 它会给你默认启动成<code>ss-server</code>, 显然, 你需要的是<code>ss-local</code>, 如果从名字可以看出它们的差别, 当然还有<code>ss-redir</code>, 你要搭建<code>透明</code>代理的话用着得, 还有<code>ss-tunnel</code>, 转发DNS.</p><blockquote>
<p><code>lsof -i:8530</code>看看跑8530端口的是哪个程序</p></blockquote>
<p>我讲解一下怎么把<code>ss-server</code>改成<code>ss-local</code>.</p><ol>
<li>它是以<code>ss-server -c &lt;configFILE&gt; -f &lt;pidFILE&gt;</code>启动的, 写在了<code>/etc/init.d/shadowsocks</code> 里面, 你把所有<code>ss-server</code>改为<code>ss-local</code>, 然后顺便把<code>-f</code>参数删掉</li>
<li>改完后, 保存: <code>update-rc.d -f shadowsocks defaults</code></li>
<li>重启: <code>/etc/init.d/shadowsocks restart</code></li>
</ol>
<p>如果需要连kcptun, 那么这里是第二个需要注意的地方, 即你的服务器地址本应为<code>shadowsocks</code>服务器地址及端口, 这里要改成<code>127.0.0.1:&lt;kcptun端口&gt;</code></p><p>shadowsocks就上述两个需要注意的地方.
如果你使用了python版, go版的, 或是手工安装的libev版, 那么<code>改ss-server</code>这个坑你就碰不到了</p><h1>kcptun</h1>
<p>下载<code>Linux</code>版的kcptun包, 选择名字里含有<code>client</code>和<code>armv7</code>的文件即可, 这里无其它坑, 选对文件是关键, 配置文件参数与服务端一致即可.</p><blockquote>
<p>网上有些文章说一定要保持server文件和client文件是同一天的, 我实测没必要. 我的server端都部署了一年了, 今天用的最新的client, 没什么问题</p></blockquote>
<h1>Privoxy</h1>
<p>这里坑比较多</p><ol>
<li>按网上普通的教程, 设置自己的监听端口(默认8118)和shadowsocks的(127.0.0.1:1080), 没问题</li>
<li>做完上一步, 我用电脑设置树莓派的8118端口为代理服务器, 居然所有流量<strong>已经</strong>(划重点)被转发了, 而理论上这时是需要你自己添加规则(<code>.action文件</code>)的,否则就是直连.</li>
<li>找了很多资料, 没人碰到跟我一样的情况, 所以我是绕了一圈, 做了一个<code>不转发所有流量</code>的规则, 然后再在后面跟上我的gfw的规则, 才会选择性地转发. 奇怪</li>
<li>最后就是网上找一个能转<code>gfwlist</code>规则的方案应用到<code>action</code>里就好, 比如<a href="https://github.com/snachx/gfwlist2privoxy">这个</a></li>
</ol>
<p>分享一个action文件编写的良好实践, 应用别名:</p>
<pre><code>{{alias}}
direct   = +forward-override{forward .}
socks    = +forward-override{forward-socks5 localhost:8080 .}
httproxy = +forward-override{forward localhost:8000 .}

{direct}
.google.com
.googleusercontent.com
.mozilla.com
【我就是在这里设了一个*.*, direct了所有的流量】

{socks}
.youtube.com
.ytimg.com

{httproxy}
.twitter.com
.blogspot.com
feedproxy.google.com
</code></pre>
<p>#总结</p><ol>
<li>树莓派对外暴露<code>Privoxy</code>的<code>8118</code>端口, 转发至<code>shadowsocks</code>的<code>1080</code>端口</li>
<li><code>shadowsocks</code>转发至<code>kcptun</code>的<code>1087</code>端口</li>
<li><code>kcptun client</code>与<code>kcptun server</code>的<code>29900</code>通讯</li>
<li><code>kcptun server</code>与<code>shadowsocks server</code>的<code>8530</code>通讯</li>
</ol>
<p>等于把拓扑图口述了一遍~~~我也是想清了这个才最终思路清晰地做完所有事的</p><p>最后, 不管是<code>privoxy</code>还是<code>shadowsocks</code>还是<code>kcptun</code>, 都是需要加入自启动的, 你可以选择在<code>/etc/rc.local</code>里面依次写入启动脚本, 也可以在<code>/etc/init.d/</code>里面添加对应的脚本文件</p><p>本文不是教程, 是排坑指南. 相应的安装, 配置, 加启动, 可以搜既有教程, 如果碰到跟我一样的问题, 希望帮助到了你.</p><p>#题外话
我的目的其实是给我的<code>Apple TV</code>第3代翻墙, 结果发现它居然不能直接设置http代理, 得用<code>Apple Configurator 2</code>来设置, 并推到设备上. 这里有两个选择</p><ol>
<li>设置全局代理(需要设备Supervised)</li>
<li>设置某个WiFi热点的代理</li>
</ol>
<p>我没去研究什么是<code>Supervised</code>了, 而且也希望代理好切换, 于是选择了第二种方案, 即换了wifi后就没代理了(跟在<code>iPhone</code>上设置一样)</p><figure  style="flex: 66.66666666666667" ><img width="1240" height="930" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/b0eb92a0c8ee8ccdfed03a8e1552c69f.jpg" alt=""/></figure><h1>TODO:</h1>
<p>udp2raw, and udp2raw on mac</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%A9%E7%94%A8Privoxy%2CShadowsocks%2CKcptun%E5%81%9Ahttp%E4%BB%A3%E7%90%86%E6%8E%92%E5%9D%91%E8%AE%B0%E5%BD%95/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
</section>

<div class="container">
    <section id="prism__page__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
        <ul>
            
            <li class="next">
                <a class="no-link" href="/page/6/" target="_self"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
            </li>
            
            
            <li class="prev">
                <a class="no-link" href="/page/8/" target="_self">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
            </li>
            
        </ul>
    </section>
</div>


</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>：🏄‍ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>：Home page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright © 2022 AlanDecode</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>